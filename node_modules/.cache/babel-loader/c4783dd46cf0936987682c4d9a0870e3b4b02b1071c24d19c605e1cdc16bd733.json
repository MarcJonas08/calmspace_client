{"ast":null,"code":"import React,{createContext,useState,useEffect}from\"react\";import{jwtDecode}from\"jwt-decode\";import{Navigate,useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export default AuthContext;export const AuthProvider=_ref=>{let{children}=_ref;const navigate=useNavigate();const[authTokens,setAuthTokens]=useState(()=>localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null);const[user,setUser]=useState(()=>localStorage.getItem('authTokens')?jwtDecode(localStorage.getItem('authTokens')):null);const[redirectToAssessment,setRedirectToAssessment]=useState(false);const[Loading,setLoading]=useState(true);const loginUser=async event=>{event.preventDefault();const response=await fetch('http://89.116.21.45:8000/api/token/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'email':event.target.username.value,'password':event.target.password.value})});const data=await response.json();if(response.status===200){setAuthTokens(data);setUser(jwtDecode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));navigate('/');console.log('USER: ',authTokens);}else{alert(\"Invalid username or password\");}};let handleLogout=()=>{setAuthTokens(null);setUser(null);localStorage.removeItem('authTokens');navigate('/login');};let updateToken=async()=>{console.log('gags');const response=await fetch('http://89.116.21.45:8000/api/token/refresh/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'refresh':authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});const data=await response.json();if(response.status===200){setAuthTokens(data);setUser(jwtDecode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));}else{handleLogout();}setLoading(false);};useEffect(()=>{if(Loading){updateToken();}let fourMinutes=1000*60*4;let interval=setInterval(()=>{if(authTokens){updateToken();}},fourMinutes);return()=>clearInterval(interval);},[authTokens,Loading]);let contextData={user:user,loginUser:loginUser,setUser:setUser,setAuthTokens:setAuthTokens,handleLogout:handleLogout,authTokens:authTokens};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:Loading?null:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","jwtDecode","Navigate","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","navigate","authTokens","setAuthTokens","localStorage","getItem","JSON","parse","user","setUser","redirectToAssessment","setRedirectToAssessment","Loading","setLoading","loginUser","event","preventDefault","response","fetch","method","headers","body","stringify","target","username","value","password","data","json","status","access","setItem","console","log","alert","handleLogout","removeItem","updateToken","refresh","fourMinutes","interval","setInterval","clearInterval","contextData","Provider"],"sources":["C:/Users/diazm/Desktop/calmspace - react/calmspace/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { Navigate, useNavigate } from 'react-router-dom';\r\n\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport default AuthContext;\r\n\r\nexport const AuthProvider = ({children}) => {\r\n\r\n    const navigate = useNavigate();\r\n\r\n    const [authTokens, setAuthTokens] = useState(() => localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null);\r\n    const [user, setUser] = useState(() => localStorage.getItem('authTokens') ? jwtDecode(localStorage.getItem('authTokens')) : null);\r\n    const [redirectToAssessment, setRedirectToAssessment] = useState(false);\r\n\r\n    const [Loading, setLoading] = useState(true);\r\n\r\n    const loginUser = async (event) => {\r\n        event.preventDefault();\r\n\r\n            const response = await fetch('http://89.116.21.45:8000/api/token/', {\r\n                method: 'POST',\r\n                headers: {\r\n                'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({'email': event.target.username.value, 'password': event.target.password.value}),\r\n            })\r\n\r\n            const data = await response.json();\r\n            \r\n            if(response.status === 200){\r\n                setAuthTokens(data)\r\n                setUser(jwtDecode(data.access))\r\n                localStorage.setItem('authTokens', JSON.stringify(data))\r\n\r\n                navigate('/');\r\n                console.log('USER: ', authTokens)\r\n\r\n            } else {\r\n                alert(\"Invalid username or password\")\r\n            }\r\n\r\n            \r\n    }\r\n\r\n    let handleLogout = () => {\r\n        setAuthTokens(null);\r\n        setUser(null);\r\n        localStorage.removeItem('authTokens');\r\n\r\n        navigate('/login');\r\n    }\r\n\r\n\r\n    let updateToken = async () => {\r\n        console.log('gags');\r\n        const response = await fetch('http://89.116.21.45:8000/api/token/refresh/', {\r\n                method: 'POST',\r\n                headers: {\r\n                'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({'refresh': authTokens?.refresh}),\r\n            })\r\n\r\n            const data = await response.json();\r\n            \r\n            if(response.status === 200){\r\n                setAuthTokens(data)\r\n                setUser(jwtDecode(data.access))\r\n                localStorage.setItem('authTokens', JSON.stringify(data))\r\n            } else {\r\n                handleLogout();\r\n            }\r\n\r\n            setLoading(false);\r\n    }\r\n\r\n    \r\n\r\n    useEffect(() => {\r\n\r\n        if (Loading){\r\n            updateToken();\r\n        }\r\n\r\n        let fourMinutes = 1000 * 60 * 4;\r\n        let interval = setInterval(() => {\r\n            if (authTokens){\r\n                updateToken();\r\n            }\r\n        }, fourMinutes)\r\n\r\n        return () => clearInterval(interval);\r\n\r\n    }, [authTokens, Loading]);\r\n\r\n    \r\n\r\n\r\n    let contextData = {\r\n        \r\n        user:user,\r\n        loginUser:loginUser,\r\n        setUser:setUser,\r\n        setAuthTokens:setAuthTokens,\r\n        handleLogout:handleLogout,\r\n        authTokens:authTokens,\r\n    };\r\n\r\n\r\n    return(\r\n        <AuthContext.Provider value={contextData}>\r\n            {Loading ? null : children}\r\n        </AuthContext.Provider>\r\n    )\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}